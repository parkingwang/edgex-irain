dist: xenial
sudo: required

services:
  - docker

addons:
  apt:
    packages:
      - docker-ce

language: go
go:
  - "1.12.4"

env:
  - DOCKER_CLI_EXPERIMENTAL=enabled
  - GOMAXPROCS=4 GO111MODULE=on

install:
  - sudo apt-get install upx -y

before_script:
  # Login Aliyun Registry
  - echo "$DOCKER_PASSWORD" | docker login registry.cn-shenzhen.aliyuncs.com -u "$DOCKER_USERNAME" --password-stdin

script:
  - go mod download
  - ./build.sh image

after_success:
  - ./build.sh push manifest

branches:
  only:
    - master
    - v0.0.2